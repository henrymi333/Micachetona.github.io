<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Te amare esta y mil vidas m치s</title>
    <link href="https://fonts.googleapis.com/css?family=Indie+Flower" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/FontLoader.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/geometries/TextGeometry.min.js"></script>
   <link rel="stylesheet" href="css/styles.css">
</head>

<style>
    
* { margin: 0; padding: 0; box-sizing: border-box; }
body { 
    overflow: hidden; 
    font-family: "Indie Flower";
    background: radial-gradient(ellipse at bottom, #0a0e1a 0%, #000000 100%);
    color: white; 
    height: 100vh; 
    width: 100vw; 
    position: relative; 
}
h2{
    color: #ff69b4;
    font-size: 1.5rem;
}
.cielo {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 0;
    pointer-events: none;
}

.estrella {
    position: absolute;
    background: white;
    border-radius: 50%;
    box-shadow: 0 0 2px white;
    animation: centellear var(--duracion) infinite alternate ease-in-out var(--retraso);
    z-index: 0;
}

@keyframes centellear {
    0%, 100% { opacity: 0.5; transform: scale(0.8); }
    50% { opacity: 1; transform: scale(1.2); }
}

.luna {
    position: absolute;
    top: 10%;
    right: 5%;
    width: 150px;
    height: 150px;
    border-radius: 50%;
    box-shadow: 0 0 50px rgba(255, 255, 255, 0.8),
                0 0 30px rgba(255, 255, 255, 0.7);
    z-index: 0;
    overflow: hidden;
    pointer-events: none;
    background-image: url('https://upload.wikimedia.org/wikipedia/commons/e/e1/FullMoon2010.jpg');
    background-size: 125%; 
    background-position: center;
    border: 1px solid rgba(255, 255, 255, 0.2); 
    filter: brightness(1.1) contrast(1.1);
}

#contenedor-escena { 
    position: absolute; 
    top: 0; 
    left: 0; 
    width: 100%; 
    height: 100%; 
    z-index: 1; 
    background: transparent;
}

#superposicion-ui { 
    position: absolute; 
    top: 0; 
    left: 0; 
    width: 100%; 
    height: 100%; 
    z-index: 10; 
    pointer-events: none; 
}

#instrucciones { 
    position: absolute; 
    bottom: 20px; 
    left: 0; 
    width: 100%; 
    text-align: center; 
    font-size: 16px; 
    padding: 12px; 
    animation: pulso 3s infinite; 
    background: rgba(0, 0, 0, 0.4); 
    backdrop-filter: blur(5px); 
}

@keyframes pulso { 
    0% { opacity: 0.7; } 
    50% { opacity: 1; } 
    100% { opacity: 0.7; } 
}

.corazon { 
    position: absolute; 
    font-size: 22px; 
    color: #ff69b4; 
    z-index: 5; 
    pointer-events: none; 
    animation: caer linear forwards; 
    text-shadow: 0 0 8px #ff1493; 
}

@keyframes caer { 
    to { 
        transform: translateY(100vh) rotate(360deg); 
        opacity: 0; 
    } 
}

#indicador-toque { 
    position: absolute; 
    width: 60px; 
    height: 60px; 
    border-radius: 50%; 
    background: radial-gradient(circle, rgba(255,105,180,0.7) 0%, rgba(255,20,147,0) 70%); 
    pointer-events: none; 
    z-index: 20; 
    opacity: 0; 
    transform: translate(-50%, -50%); 
}

#cargando { 
    position: fixed; 
    top: 0; 
    left: 0; 
    width: 100%; 
    height: 100%; 
    display: flex; 
    flex-direction: column;
    justify-content: center; 
    align-items: center; 
    font-size: 22px; 
    z-index: 100; 
    background: radial-gradient(circle at center, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
    backdrop-filter: blur(5px);
    color: #fff;
}

.contenido-cargando {
    background: rgba(0, 0, 0, 0.6);
    padding: 30px 50px;
    border-radius: 15px;
    text-align: center;
    box-shadow: 0 0 30px rgba(100, 149, 237, 0.7);
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.cargador-reloj {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    position: relative;
    margin: 20px auto;
    background: conic-gradient(#ff69b4 0%, #ff69b4 var(--progreso, 0%), #4a4a8a var(--progreso, 0%), #4a4a8a 100%);
    display: flex;
    justify-content: center;
    align-items: center;
    box-shadow: 0 0 20px rgba(255, 105, 180, 0.5);
}

.cargador-reloj::before {
    content: '';
    position: absolute;
    width: 70px;
    height: 70px;
    border-radius: 50%;
    background: #1a1a2e;
}

.manecilla-reloj {
    position: absolute;
    width: 3px;
    height: 30px;
    background: #ff69b4;
    top: 10px;
    left: 50%;
    transform-origin: bottom center;
    transform: translateX(-50%) rotate(0deg);
    box-shadow: 0 0 5px #ff69b4;
    z-index: 1;
    animation: rotar-reloj 2s linear infinite;
}

@keyframes rotar-reloj {
    0% { transform: translateX(-50%) rotate(0deg); }
    100% { transform: translateX(-50%) rotate(360deg); }
}

.centro-reloj {
    position: absolute;
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background: #ff69b4;
    z-index: 2;
    box-shadow: 0 0 10px #ff69b4;
}

.texto-progreso {
    margin-top: 10px;
    font-size: 18px;
    color: #ff69b4;
    text-shadow: 0 0 5px rgba(255, 105, 180, 0.7);
}

#puntos-cargando { animation: puntos 1.5s infinite; }
@keyframes puntos { 0%, 20% { content: "."; } 40% { content: ".."; } 60%, 100% { content: "..."; } }

.galeria { 
    position: absolute; 
    bottom: 80px; 
    left: 0; 
    width: 100%; 
    display: flex; 
    justify-content: center; 
    gap: 10px; 
    padding: 0 10px; 
    z-index: 15; 
    pointer-events: auto; 
}

.elemento-galeria { 
    width: 70px; 
    height: 70px; 
    border-radius: 10px; 
    overflow: hidden; 
    cursor: pointer; 
    border: 2px solid rgba(255, 255, 255, 0.3); 
    transition: all 0.3s ease; 
    background: rgba(0, 0, 0, 0.5); 
    backdrop-filter: blur(5px); 
}

.elemento-galeria:hover { 
    transform: scale(1.1); 
    border-color: #ff69b4; 
}

.elemento-galeria img { 
    width: 100%; 
    height: 100%; 
    object-fit: cover; 
}

.modal { 
    display: none; 
    position: fixed; 
    top: 0; 
    left: 0; 
    width: 100%; 
    height: 100%; 
    background: rgba(0, 0, 0, 0.9); 
    z-index: 100; 
    justify-content: center; 
    align-items: center; 
}

.contenido-modal { 
    max-width: 90%; 
    max-height: 80%; 
    border-radius: 15px; 
    box-shadow: 0 0 50px rgba(255, 105, 180, 0.5); 
}

.mensaje-modal { 
    position: absolute; 
    bottom: 50px; 
    left: 0; 
    width: 100%; 
    text-align: center; 
    font-size: 20px; 
    color: #ff69b4; 
    text-shadow: 0 0 10px #ff1493; 
    padding: 15px; 
    background: rgba(0, 0, 0, 0.7); 
    backdrop-filter: blur(10px); 
}

.boton-cerrar { 
    position: absolute; 
    top: 20px; 
    right: 30px; 
    font-size: 40px; 
    color: white; 
    cursor: pointer; 
    z-index: 101; 
}

#alternar-audio { 
    position: absolute; 
    top: 15px; 
    right: 15px; 
    background: rgba(255, 255, 255, 0.15); 
    border: 1px solid rgba(255, 255, 255, 0.25); 
    color: white; 
    padding: 8px 12px; 
    border-radius: 20px; 
    cursor: pointer; 
    z-index: 15; 
    font-size: 14px; 
    backdrop-filter: blur(10px); 
    pointer-events: auto; 
    transition: all 0.3s ease; 
    opacity: 0.8; 
}

#alternar-audio:hover { 
    opacity: 1; 
    background: rgba(255, 255, 255, 0.25); 
}
@media (min-width: 768px) { 
        .contenido-modal { 
        min-width: 25% ;
        min-height: 25%; 
        border-radius: 15px; 
        box-shadow: 0 0 50px rgba(255, 105, 180, 0.5); 
    }
}
@media (max-width: 768px) { 
    .galeria { bottom: 70px; gap: 5px; }
    .elemento-galeria { width: 60px; height: 60px; }
    #instrucciones { font-size: 14px; padding: 10px; }
    .contenido-modal { max-width: 95%; max-height: 70%; }
    .mensaje-modal { font-size: 18px; bottom: 30px; }
    .luna { width: 100px; height: 100px; }
}

@media (max-width: 480px) {
    .galeria { bottom: 60px; }
    .elemento-galeria { width: 50px; height: 50px; }
    .mensaje-modal { font-size: 16px; padding: 10px; }
    .luna { width: 70px; height: 70px; }
}

</style>
<body>
    <div class="cielo" id="cielo-estrellas">
        <div class="luna"></div>
    </div>

    <div id="cargando">
        <div class="contenido-cargando">
           <h2> Cargando mi amor...</h2><span id="puntos-cargando"></span>
            <div class="cargador-reloj" id="cargador-reloj">
                <div class="manecilla-reloj"></div>
                <div class="centro-reloj"></div>
            </div>
            <div class="texto-progreso" id="texto-progreso">0%</div>
        </div>
    </div>
    
    <div id="contenedor-escena"></div>
    
    <div id="superposicion-ui">
        <button id="alternar-audio">OFF</button>
        <div id="indicador-toque"></div>
    </div>

    <div id="modal-imagen" class="modal">
        <span class="boton-cerrar">&times;</span>
        <img class="contenido-modal" id="imagen-modal">
        <div class="mensaje-modal" id="mensaje-modal"></div>
    </div>

    <audio id="audio-fondo" loop>
        <source src="" type="audio/mpeg">
    </audio>
</body>
<script >
    
let escena, camara, renderizador, saturno, controles, fuente;
let lluviaCorazonesActiva = false, contadorToques = 0;
let objetosMensaje = [];
let objetosTextoAnillo = [];
let audioHabilitado = false;
let audioReproducido = false;

const cargadorTexturas = new THREE.TextureLoader();
const cargadorFuentes = new THREE.FontLoader();

const URL_TEXTURA_SATURNO = '1.jpg';

const textoAnillo = "PARA EL AMOR DE MI VIDA - TE AMO CON TODO MI CORAZ칍N";

const mensajesAmor = [
    { type: 'image', content: '2.jpg' },
    { type: 'image', content: '3.jpg' },
    { type: 'image', content: '4.jpg' },
    { type: 'image', content: '5.jpg' },
    { type: 'image', content: '14.jpg' },
    { type: 'image', content: '8.jpg' },
    { type: 'image', content: '10.jpg' },
    { type: 'image', content: '13.jpg' },
    { type: 'image', content: '15.jpg' },

    { type: 'text', content: "Te amo" },
    { type: 'text', content: "My Love" },
    { type: 'text', content: "Eres preciosa" },
    { type: 'text', content: "Me encantas" },
    { type: 'text', content: "Amor de mi vida" },
    { type: 'text', content: "Para ti" },
    { type: 'text', content: "Mi reina" },
    { type: 'text', content: "Una diosa" },
    { type: 'text', content: "Te amo" },
    { type: 'text', content: "My Love" },
    { type: 'text', content: "Eres preciosa" },
    { type: 'text', content: "Me encantas" },
    { type: 'text', content: "Amor de mi vida" },
    { type: 'text', content: "Para ti" },
    { type: 'text', content: "Mi reina" },
    { type: 'text', content: "Una diosa" },
    { type: 'text', content: "Te amo" },
    { type: 'text', content: "My Love" },
    { type: 'text', content: "Eres preciosa" },
    { type: 'text', content: "Me encantas" },
    { type: 'text', content: "Amor de mi vida" },
    { type: 'text', content: "Para ti" },
    { type: 'text', content: "Mi reina" },
    { type: 'text', content: "Una diosa" },
    { type: 'text', content: "Te amo" },
    { type: 'text', content: "My Love" },
    { type: 'text', content: "Eres preciosa" },
    { type: 'text', content: "Me encantas" },
    { type: 'text', content: "Amor de mi vida" },
    { type: 'text', content: "Para ti" },
    { type: 'text', content: "Mi reina" },
    { type: 'text', content: "Una diosa" },
     
    
];


function crearEstrellasCSS(cantidad) {
    const cielo = document.getElementById('cielo-estrellas');
    for (let i = 0; i < cantidad; i++) {
        const estrella = document.createElement('div');
        estrella.classList.add('estrella');
        const tama침o = Math.random() * 2 + 1;
        estrella.style.width = tama침o + 'px';
        estrella.style.height = tama침o + 'px';
        estrella.style.left = Math.random() * 100 + 'vw';
        estrella.style.top = Math.random() * 100 + 'vh';
        estrella.style.setProperty('--retraso', Math.random() * 5 + 's');
        estrella.style.setProperty('--duracion', (Math.random() * 4 + 2) + 's');
        cielo.appendChild(estrella);
    }
}

function cargarRecursos() {
    return Promise.all([
        new Promise((resolver) => {
            cargadorFuentes.load(
                'https://threejs.org/examples/fonts/gentilis_regular.typeface.json',
                (fuenteCargada) => {
                    fuente = fuenteCargada;
                    resolver();
                },
                undefined,
                (error) => {
                    console.error('Error cargando la fuente:', error);
                    resolver();
                }
            );
        })
    ]);
}

function simularCarga() {
    const cargadorReloj = document.getElementById('cargador-reloj');
    const textoProgreso = document.getElementById('texto-progreso');
    let progreso = 0;
    
    const intervalo = setInterval(() => {
        progreso += 1;
        if (progreso <= 100) {
            cargadorReloj.style.setProperty('--progreso', progreso + '%');
            textoProgreso.textContent = progreso + '%';
        } else {
            clearInterval(intervalo);
        }
    }, 30);
}

function inicializar() {
    simularCarga();
    
    setTimeout(() => {
        document.getElementById('cargando').style.display = 'none';
        
        escena = new THREE.Scene();
        escena.background = null;
        
        camara = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
        camara.position.set(0, 8, 30);
        
        renderizador = new THREE.WebGLRenderer({ 
            antialias: true, 
            alpha: true,
            powerPreference: "high-performance" 
        });
        renderizador.setSize(window.innerWidth, window.innerHeight);
        renderizador.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        renderizador.shadowMap.enabled = true;
        renderizador.shadowMap.type = THREE.PCFSoftShadowMap;
        renderizador.toneMapping = THREE.ACESFilmicToneMapping;
        renderizador.toneMappingExposure = 1.2;
        renderizador.setClearColor(0x000000, 0);
        
        document.getElementById('contenedor-escena').appendChild(renderizador.domElement);
        
        controles = new THREE.OrbitControls(camara, renderizador.domElement);
        controles.enableDamping = true;
        controles.dampingFactor = 0.05;
        controles.rotateSpeed = 0.5;
        controles.enableZoom = true;
        controles.autoRotate = true;
        controles.autoRotateSpeed = 0.2;
        controles.minDistance = 20;
        controles.maxDistance = 60;
        
        controles.addEventListener('change', manejarMovimientoCamara);
        
        const luzAmbiental = new THREE.AmbientLight(0x444477, 0.4);
        escena.add(luzAmbiental);
        
        const luzDireccional = new THREE.DirectionalLight(0xffffff, 1.5);
        luzDireccional.position.set(10, 10, 5);
        luzDireccional.castShadow = true;
        escena.add(luzDireccional);
        
        const luzPunto = new THREE.PointLight(0xff69b4, 0.6, 50);
        luzPunto.position.set(0, 0, 10);
        escena.add(luzPunto);
        
        const luzTrasera = new THREE.DirectionalLight(0x4466aa, 0.6);
        luzTrasera.position.set(-5, -5, -5);
        escena.add(luzTrasera);
        
        crearSaturno();
        crearAnilloTexto();
        crearCampoEstrellas();
        crearMensajesAmor();
        crearParticulasFlotantes();
        
        configurarEventos();
        
        animar();
    }, 3500);
}

function crearSaturno() {
    const geometria = new THREE.SphereGeometry(4, 128, 128);
    const materialTemporal = new THREE.MeshPhongMaterial({ color: 0xddaa77, shininess: 10 });
    
    saturno = new THREE.Mesh(geometria, materialTemporal);
    saturno.castShadow = true;
    saturno.receiveShadow = true;
    escena.add(saturno);
    
    cargadorTexturas.load(URL_TEXTURA_SATURNO, 
        (textura) => {
            textura.anisotropy = renderizador.capabilities.getMaxAnisotropy();
            const material = new THREE.MeshPhongMaterial({ 
                map: textura, bumpScale: 0.05, specular: new THREE.Color(0x333333), shininess: 15
            });
            saturno.material = material;
        },
        undefined,
        (error) => {
            console.error('Error cargando textura de Saturno:', error);
        }
    );
    
    const geometriaAtmosfera = new THREE.SphereGeometry(4.15, 64, 64);
    const materialAtmosfera = new THREE.MeshPhongMaterial({
        color: 0x88aaff, transparent: true, opacity: 0.08, side: THREE.BackSide
    });
    const atmosfera = new THREE.Mesh(geometriaAtmosfera, materialAtmosfera);
    saturno.add(atmosfera);
}

function crearAnilloTexto() {
    const radio = 7;
    const totalLetras = textoAnillo.length;
    const pasoAngulo = (Math.PI * 2) / totalLetras;
    
    const geometriaAnilloInterno = new THREE.RingGeometry(4.8, 5.2, 64);
    const materialAnilloInterno = new THREE.MeshPhongMaterial({
        color: 0xffccff,
        side: THREE.DoubleSide,
        transparent: true,
        opacity: 0.3,
        emissive: 0x330022
    });
    const anilloInterno = new THREE.Mesh(geometriaAnilloInterno, materialAnilloInterno);
    anilloInterno.rotation.x = Math.PI / 2 + 0.1;
    escena.add(anilloInterno);
    
    const geometriaAnilloExterno = new THREE.RingGeometry(8.8, 9.2, 64);
    const materialAnilloExterno = new THREE.MeshPhongMaterial({
        color: 0xffccff,
        side: THREE.DoubleSide,
        transparent: true,
        opacity: 0.3,
        emissive: 0x330022
    });
    const anilloExterno = new THREE.Mesh(geometriaAnilloExterno, materialAnilloExterno);
    anilloExterno.rotation.x = Math.PI / 2 + 0.1;
    escena.add(anilloExterno);
    
    if (fuente) {
        for (let i = 0; i < totalLetras; i++) {
            const letra = textoAnillo[i];
            
            const geometriaTexto = new THREE.TextGeometry(letra, {
                font: fuente,
                size: 0.4,
                height: 0.05,
                curveSegments: 12,
                bevelEnabled: true,
                bevelThickness: 0.01,
                bevelSize: 0.02,
                bevelSegments: 3
            });
            
            const materialTexto = new THREE.MeshPhongMaterial({
                color: 0xDC143C,
                emissive: 0x550044,
                specular: 0xffaaff,
                shininess: 100,
                transparent: true,
                opacity: 0.9
            });
            
            const mallaTexto = new THREE.Mesh(geometriaTexto, materialTexto);
            
            const angulo = -i * pasoAngulo;
            mallaTexto.position.x = Math.cos(angulo) * radio;
            mallaTexto.position.z = Math.sin(angulo) * radio;
            mallaTexto.position.y = 0;
            
            mallaTexto.rotation.y = angulo + Math.PI;
            mallaTexto.rotation.x = Math.PI / 2;
            
            escena.add(mallaTexto);
            objetosTextoAnillo.push(mallaTexto);
        }
    } else {
        crearAnilloRespaldo();
    }
}

function crearAnilloRespaldo() {
    const radio = 7;
    const totalEsferas = textoAnillo.length * 2;
    const pasoAngulo = (Math.PI * 2) / totalEsferas;
    
    for (let i = 0; i < totalEsferas; i++) {
        const geometriaEsfera = new THREE.SphereGeometry(0.1, 8, 8);
        const materialEsfera = new THREE.MeshPhongMaterial({
            color: 0xffccff,
            emissive: 0x550044,
            transparent: true,
            opacity: 0.9
        });
        
        const esfera = new THREE.Mesh(geometriaEsfera, materialEsfera);
        
        const angulo = i * pasoAngulo;
        esfera.position.x = Math.cos(angulo) * radio;
        esfera.position.z = Math.sin(angulo) * radio;
        esfera.position.y = 0;
        
        escena.add(esfera);
        objetosTextoAnillo.push(esfera);
    }
}

function crearCampoEstrellas() {
    const geometriaEstrellas = new THREE.BufferGeometry();
    const materialEstrellas = new THREE.PointsMaterial({
        color: 0xffffff, size: 0.2, transparent: true, sizeAttenuation: true
    });
    
    const verticesEstrellas = [];
    for (let i = 0; i < 10000; i++) {
        verticesEstrellas.push((Math.random() - 0.5) * 2000, (Math.random() - 0.5) * 2000, (Math.random() - 0.5) * 2000);
    }
    
    geometriaEstrellas.setAttribute('position', new THREE.Float32BufferAttribute(verticesEstrellas, 3));
    const campoEstrellas = new THREE.Points(geometriaEstrellas, materialEstrellas);
    escena.add(campoEstrellas);
}

function crearMensajesAmor() {
    const mensajesMezclados = [...mensajesAmor].sort(() => Math.random() - 0.5);
    const mensajesAUsar = mensajesMezclados.slice(0, 50);

    mensajesAUsar.forEach((mensajeObj, i) => {
        let malla; 

        if (mensajeObj.type === 'image') {
            const geometriaPlano = new THREE.PlaneGeometry(2, 2); 
            const textura = cargadorTexturas.load(mensajeObj.content);
            const materialPlano = new THREE.MeshBasicMaterial({
                map: textura,
                transparent: true,
                side: THREE.DoubleSide
            });
            malla = new THREE.Mesh(geometriaPlano, materialPlano);
        }
        else {
            if (fuente) {
                const geometriaTexto = new THREE.TextGeometry(mensajeObj.content, { 
                    font: fuente,
                    size: 0.4,
                    height: 0.1,
                    curveSegments: 8,
                    bevelEnabled: true,
                    bevelThickness: 0.02,
                    bevelSize: 0.03,
                    bevelSegments: 3
                });
                geometriaTexto.computeBoundingBox();
                geometriaTexto.center();
                malla = new THREE.Mesh(geometriaTexto, crearMaterialTexto());
            } else {
                malla = crearTextoRespaldo(mensajeObj.content); 
            }
        }

        const distancia = 10 + Math.random() * 8;
        const angulo = Math.random() * Math.PI * 2;
        const altura = (Math.random() - 0.5) * 10;

        malla.position.set(Math.cos(angulo) * distancia, altura, Math.sin(angulo) * distancia);

        escena.add(malla);
        objetosMensaje.push({
            malla: malla,
            alturaOriginal: altura,
            velocidad: 0.2 + Math.random() * 0.3,
            angulo: angulo,
            distancia: distancia
        });
    });
}

function crearMaterialTexto() {
    return new THREE.MeshStandardMaterial({
        color: 0xff69b4, 
        emissive: 0x550033,
        emissiveIntensity: 0.8,
        metalness: 0.3,
        roughness: 0.7,
        transparent: true, 
        opacity: 0.9
    });
}
    

function crearTextoRespaldo(mensaje) {
    const grupo = new THREE.Group();
    
    for (let i = 0; i < mensaje.length; i++) {
        const geometriaEsfera = new THREE.SphereGeometry(0.1, 6, 6);
        const materialEsfera = crearMaterialTexto();
        const esfera = new THREE.Mesh(geometriaEsfera, materialEsfera);
        esfera.position.x = i * 0.3;
        grupo.add(esfera);
    }
    
    return grupo;
}

function crearParticulasFlotantes() {
    const geometriaParticulas = new THREE.BufferGeometry();
    const cantidadParticulas = 1500;
    
    const posiciones = new Float32Array(cantidadParticulas * 3);
    const colores = new Float32Array(cantidadParticulas * 3);
    
    for (let i = 0; i < cantidadParticulas * 3; i += 3) {
        posiciones[i] = (Math.random() - 0.5) * 200;
        posiciones[i + 1] = (Math.random() - 0.5) * 200;
        posiciones[i + 2] = (Math.random() - 0.5) * 200;
        
        colores[i] = Math.random() * 0.5 + 0.5;
        colores[i + 1] = Math.random() * 0.3 + 0.3;
        colores[i + 2] = Math.random() * 0.7 + 0.3;
    }
    
    geometriaParticulas.setAttribute('position', new THREE.BufferAttribute(posiciones, 3));
    geometriaParticulas.setAttribute('color', new THREE.BufferAttribute(colores, 3));
    
    const materialParticulas = new THREE.PointsMaterial({
        size: 0.1, 
        vertexColors: true, 
        transparent: true, 
        opacity: 0.7
    });
    
    const particulas = new THREE.Points(geometriaParticulas, materialParticulas);
    escena.add(particulas);
}

function configurarEventos() {
    document.addEventListener('click', manejarInteraccion);
    document.addEventListener('touchstart', manejarInteraccion);
    
    document.addEventListener('click', mostrarEfectoToque);
    document.addEventListener('touchstart', mostrarEfectoToque);
    
    document.querySelectorAll('.elemento-galeria').forEach(elemento => {
        elemento.addEventListener('click', abrirModal);
    });
    
    document.querySelector('.boton-cerrar').addEventListener('click', cerrarModal);
    
    document.getElementById('alternar-audio').addEventListener('click', alternarAudio);
    
    window.addEventListener('resize', manejarRedimensionamiento);
    window.addEventListener('wheel', manejarDesplazamiento);
}

function manejarMovimientoCamara() {
    if (audioHabilitado && !audioReproducido) {
        reproducirAudio();
    }
}

function manejarDesplazamiento() {
    if (audioHabilitado && !audioReproducido) {
        reproducirAudio();
    }
}

function alternarAudio() {
    audioHabilitado = !audioHabilitado;
    const botonAudio = document.getElementById('alternar-audio');
    
    if (audioHabilitado) {
        botonAudio.textContent = 'ON';
        botonAudio.style.background = 'rgba(255, 105, 180, 0.3)';
        reproducirAudio();
    } else {
        botonAudio.textContent = 'OFF';
        botonAudio.style.background = 'rgba(255, 255, 255, 0.15)';
        pausarAudio();
    }
}

function reproducirAudio() {
    const audio = document.getElementById('audio-fondo');
    if (audioHabilitado) {
        audio.play().then(() => {
            audioReproducido = true;
        }).catch(e => {
            console.log("Audio requiere interacci칩n del usuario primero para reproducirse.");
        });
    }
}

function pausarAudio() {
    const audio = document.getElementById('audio-fondo');
    audio.pause();
}

function manejarInteraccion(e) {
    if (e.target.closest('.elemento-galeria') || e.target.closest('.modal') || e.target.closest('#alternar-audio') || document.getElementById('cargando').style.display !== 'none') return;
    
    if (!audioReproducido) {
        audioHabilitado = true;
        document.getElementById('alternar-audio').textContent = 'ON';
        document.getElementById('alternar-audio').style.background = 'rgba(255, 105, 180, 0.3)';
        reproducirAudio();
    }
    
    crearExplosionTexto(e);
    crearLluviaCorazones();
    
    contadorToques++;
    if (contadorToques === 5) {
        document.getElementById('instrucciones').textContent = "춰Eres incre칤ble! Cada toque es un latido de mi coraz칩n 仇벒잺";
    } else if (contadorToques === 10) {
        document.getElementById('instrucciones').textContent = "Eres el amor de mi vida 游눘";
    } else if (contadorToques >= 15) {
        const mensajes = ["Mi coraz칩n late por ti", "Eres mi sue침o hecho realidad", "Eres mi todo", "Te amo m치s cada d칤a", "Eres mi raz칩n de ser"];
        document.getElementById('instrucciones').textContent = mensajes[Math.floor(Math.random() * mensajes.length)];
    }
}

function crearExplosionTexto(e) {
    const x = e.type === 'touchstart' ? e.touches[0].clientX : e.clientX;
    const y = e.type === 'touchstart' ? e.touches[0].clientY : e.clientY;
    
    const textosAmor = ["TE AMO", "MY CACHETONA", "MI VIDA", "MIS OJOS DE LUCERO", "MI TODO"];
    const textoAleatorio = textosAmor[Math.floor(Math.random() * textosAmor.length)];
    
    const explosionTexto = document.createElement('div');
    explosionTexto.innerHTML = textoAleatorio;
    explosionTexto.style.position = 'absolute';
    explosionTexto.style.left = x + 'px';
    explosionTexto.style.top = y + 'px';
    explosionTexto.style.fontSize = '24px';
    explosionTexto.style.color = '#ff69b4';
    explosionTexto.style.fontWeight = 'bold';
    explosionTexto.style.textShadow = '0 0 10px #ff1493';
    explosionTexto.style.zIndex = '20';
    explosionTexto.style.pointerEvents = 'none';
    explosionTexto.style.transform = 'translate(-50%, -50%)';
    explosionTexto.style.animation = 'animacionExplosionTexto 1.5s ease-out forwards';
    
    document.getElementById('superposicion-ui').appendChild(explosionTexto);
    
    setTimeout(() => {
        if (explosionTexto.parentNode) explosionTexto.parentNode.removeChild(explosionTexto);
    }, 1500);
}

const estilo = document.createElement('style');
estilo.textContent = `
    @keyframes animacionExplosionTexto {
        0% {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
        }
        100% {
            opacity: 0;
            transform: translate(-50%, -50%) scale(3);
        }
    }
`;
document.head.appendChild(estilo);

function mostrarEfectoToque(e) {
    if (e.target.closest('.elemento-galeria') || e.target.closest('.modal') || e.target.closest('#alternar-audio') || document.getElementById('cargando').style.display !== 'none') return;
    
    const indicador = document.getElementById('indicador-toque');
    const x = e.type === 'touchstart' ? e.touches[0].clientX : e.clientX;
    const y = e.type === 'touchstart' ? e.touches[0].clientY : e.clientY;
    
    indicador.style.left = x + 'px';
    indicador.style.top = y + 'px';
    indicador.style.opacity = '1';
    
    setTimeout(() => { indicador.style.opacity = '0'; }, 300);
}

function crearLluviaCorazones() {
    if (lluviaCorazonesActiva) return;
    
    lluviaCorazonesActiva = true;
    
    for (let i = 0; i < 25; i++) {
        setTimeout(() => crearCorazon(), i * 80);
    }
    
    crearCorazones3D();
    
    setTimeout(() => { lluviaCorazonesActiva = false; }, 3000);
}

function crearCorazon() {
    const corazon = document.createElement('div');
    corazon.innerHTML = '仇벒잺';
    corazon.classList.add('corazon');
    corazon.style.left = Math.random() * 100 + 'vw';
    corazon.style.fontSize = (Math.random() * 20 + 18) + 'px';
    corazon.style.animationDuration = (Math.random() * 2 + 2) + 's';
    
    document.getElementById('superposicion-ui').appendChild(corazon);
    
    setTimeout(() => {
        if (corazon.parentNode) corazon.parentNode.removeChild(corazon);
    }, 5000);
}

function crearCorazones3D() {
    for (let i = 0; i < 10; i++) {
        const geometriaCorazon = new THREE.SphereGeometry(0.15, 8, 8);
        const materialCorazon = new THREE.MeshPhongMaterial({ color: 0xff69b4, emissive: 0x990044 });
        
        const corazon = new THREE.Mesh(geometriaCorazon, materialCorazon);
        corazon.position.set((Math.random() - 0.5) * 20, 10 + Math.random() * 5, (Math.random() - 0.5) * 20);
        
        escena.add(corazon);
        animarCorazon3D(corazon);
    }
}

function animarCorazon3D(corazon) {
    const velocidadCaida = Math.random() * 0.05 + 0.02;
    const velocidadRotacion = Math.random() * 0.1 + 0.05;
    
    function animar() {
        corazon.position.y -= velocidadCaida;
        corazon.rotation.x += velocidadRotacion;
        corazon.rotation.z += velocidadRotacion;
        
        if (corazon.position.y > -10) {
            requestAnimationFrame(animar);
        } else {
            escena.remove(corazon);
        }
    }
    
    animar();
}

function abrirModal(e) {
    const indice = parseInt(e.currentTarget.getAttribute('data-indice'));
    const modal = document.getElementById('modal-imagen');
    const imagenModal = document.getElementById('imagen-modal');
    const mensajeModal = document.getElementById('mensaje-modal');
    
    imagenModal.src = e.currentTarget.querySelector('img').src;
    mensajeModal.textContent = mensajesImagen[indice];
    
    modal.style.display = 'flex';
}

function cerrarModal() {
    document.getElementById('modal-imagen').style.display = 'none';
}

function manejarRedimensionamiento() {
    camara.aspect = window.innerWidth / window.innerHeight;
    camara.updateProjectionMatrix();
    renderizador.setSize(window.innerWidth, window.innerHeight);
}

function animar() {
    requestAnimationFrame(animar);
    
    saturno.rotation.y += 0.001;
    
    objetosTextoAnillo.forEach((obj, i) => {
        obj.rotation.y += 0.001;
        obj.position.y = Math.sin(Date.now() * 0.001 + i * 0.1) * 0.2;
        
        obj.lookAt(camara.position);
    });
    
    const tiempo = Date.now() * 0.001;
    
    objetosMensaje.forEach((obj, i) => {
        obj.malla.position.y = obj.alturaOriginal + Math.sin(tiempo * obj.velocidad + i) * 1.5;
        obj.angulo += 0.001 * obj.velocidad;
        obj.malla.position.x = Math.cos(obj.angulo) * obj.distancia;
        obj.malla.position.z = Math.sin(obj.angulo) * obj.distancia;
        
        obj.malla.lookAt(camara.position);
    });
    
    controles.update();
    renderizador.render(escena, camara);
}

cargarRecursos().then(() => {
    crearEstrellasCSS(150);
    inicializar();
});

</script>
</html>